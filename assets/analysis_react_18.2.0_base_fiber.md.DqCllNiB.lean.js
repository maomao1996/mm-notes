import{_ as i,h as a,a8 as e,o as n}from"./chunks/framework.BU7NHiAd.js";const l="/mm-notes/assets/rootfiber.Bn0cRxki.png",r="/mm-notes/assets/workInProgressFiber.Ds4NUgZv.png",p="/mm-notes/assets/wipTreeFinish.D-HqOC5J.png",t="/mm-notes/assets/wipTreeUpdate.CnlbHo_4.png",h="/mm-notes/assets/currentTreeUpdate.CIK7efGx.png",y=JSON.parse('{"title":"Fiber æ¶æ„å’ŒåŒç¼“å­˜","description":"èŒ‚èŒ‚çš„ React v18.2.0 æºç é˜…è¯»ç¬”è®° â€”â€” Fiber æ¶æ„å’ŒåŒç¼“å­˜","frontmatter":{"description":"èŒ‚èŒ‚çš„ React v18.2.0 æºç é˜…è¯»ç¬”è®° â€”â€” Fiber æ¶æ„å’ŒåŒç¼“å­˜"},"headers":[],"relativePath":"analysis/react/18.2.0/base/fiber.md","filePath":"analysis/react/18.2.0/base/fiber.md","lastUpdated":1716130066000}'),k={name:"analysis/react/18.2.0/base/fiber.md"};function d(c,s,o,b,g,F){return n(),a("div",null,s[0]||(s[0]=[e(`<h1 id="fiber-æ¶æ„å’ŒåŒç¼“å­˜" tabindex="-1">Fiber æ¶æ„å’ŒåŒç¼“å­˜ <a class="header-anchor" href="#fiber-æ¶æ„å’ŒåŒç¼“å­˜" aria-label="Permalink to &quot;Fiber æ¶æ„å’ŒåŒç¼“å­˜&quot;">â€‹</a></h1><p>React 16 å¼€å§‹å¼•å…¥äº† Fiber æ¶æ„ï¼Œå®ƒçš„ä¸»è¦ç›®çš„æ˜¯ä¸ºäº†è§£å†³ React 15 å­˜åœ¨çš„ä¸€äº›é—®é¢˜ï¼Œæ¯”å¦‚é€’å½’è°ƒç”¨æ ˆè¿‡æ·±å¯¼è‡´çš„å¡é¡¿ã€æ— æ³•ä¸­æ–­æ¸²æŸ“ã€æ— æ³•ä¼˜å…ˆçº§æ›´æ–°ç­‰ã€‚å³<strong>å°†é€’å½’çš„æ— æ³•ä¸­æ–­çš„æ›´æ–°é‡æ„ä¸ºå¼‚æ­¥çš„å¯ä¸­æ–­æ›´æ–°</strong></p><h2 id="fiber-çš„å«ä¹‰" tabindex="-1">Fiber çš„å«ä¹‰ <a class="header-anchor" href="#fiber-çš„å«ä¹‰" aria-label="Permalink to &quot;Fiber çš„å«ä¹‰&quot;">â€‹</a></h2><p>Fiber çš„ä¸‰å±‚å«ä¹‰ï¼š</p><ul><li><strong>ä½œä¸ºæ¶æ„</strong>æ¥è¯´ï¼š <ul><li>React 15 çš„ <code>Reconciler</code> é‡‡ç”¨é€’å½’çš„æ–¹å¼æ‰§è¡Œï¼Œæ•°æ®ä¿å­˜åœ¨é€’å½’è°ƒç”¨æ ˆä¸­ï¼Œæ‰€ä»¥è¢«ç§°ä¸º <code>stack Reconciler</code></li><li>React 16 çš„ <code>Reconciler</code> åŸºäº <code>Fiber èŠ‚ç‚¹</code> å®ç°ï¼Œè¢«ç§°ä¸º <code>Fiber Reconciler</code></li></ul></li><li><strong>ä½œä¸ºé™æ€çš„æ•°æ®ç»“æ„</strong>æ¥è¯´ï¼šæ¯ä¸ª <code>Fiber èŠ‚ç‚¹</code> å¯¹åº”ä¸€ä¸ª <code>React element</code> ï¼Œä¿å­˜äº†è¯¥ç»„ä»¶çš„ç±»å‹ï¼ˆå‡½æ•°ç»„ä»¶/ç±»ç»„ä»¶/åŸç”Ÿç»„ä»¶...ï¼‰ã€å¯¹åº”çš„ DOM èŠ‚ç‚¹ç­‰ä¿¡æ¯</li><li><strong>ä½œä¸ºåŠ¨æ€çš„å·¥ä½œå•å…ƒ</strong>æ¥è¯´ï¼šæ¯ä¸ª <code>Fiber èŠ‚ç‚¹</code> ä¿å­˜äº†æœ¬æ¬¡æ›´æ–°ä¸­è¯¥ç»„ä»¶æ”¹å˜çš„çŠ¶æ€ã€è¦æ‰§è¡Œçš„å·¥ä½œï¼ˆéœ€è¦è¢«åˆ é™¤/è¢«æ’å…¥é¡µé¢ä¸­/è¢«æ›´æ–°...ï¼‰</li></ul><div class="tip custom-block"><p class="custom-block-title">Fiber Reconciler çš„ä¸»è¦ä½œç”¨</p><ul><li>èƒ½å¤ŸæŠŠå¯ä¸­æ–­çš„ä»»åŠ¡åˆ‡ç‰‡å¤„ç†</li><li>èƒ½å¤Ÿè°ƒæ•´ä¼˜å…ˆçº§ï¼Œé‡ç½®å¹¶å¤ç”¨ä»»åŠ¡</li><li>èƒ½å¤Ÿåœ¨çˆ¶å…ƒç´ ä¸å­å…ƒç´ ä¹‹é—´äº¤é”™å¤„ç†ï¼Œä»¥æ”¯æŒ React ä¸­çš„å¸ƒå±€</li><li>èƒ½å¤Ÿåœ¨ <code>render()</code> ä¸­è¿”å›å¤šä¸ªå…ƒç´ </li><li>æ›´å¥½åœ°æ”¯æŒé”™è¯¯è¾¹ç•Œ</li></ul><p><a href="https://zh-hans.legacy.reactjs.org/docs/codebase-overview.html#fiber-reconciler" target="_blank" rel="noreferrer">Fiber reconciler | React æ—§ç‰ˆå®˜æ–¹æ–‡æ¡£</a></p></div><h2 id="fiber-çš„æ•°æ®ç»“æ„" tabindex="-1">Fiber çš„æ•°æ®ç»“æ„ <a class="header-anchor" href="#fiber-çš„æ•°æ®ç»“æ„" aria-label="Permalink to &quot;Fiber çš„æ•°æ®ç»“æ„&quot;">â€‹</a></h2><p>Fiber ä¸Šä¸»è¦æœ‰ DOMã€Fiber æ ‘ã€çŠ¶æ€æ•°æ®ã€å‰¯ä½œç”¨å››ç§æ ‡è¯†</p><blockquote><p>æºç åœ°å€ <a href="https://github.com/maomao1996/code-analysis/blob/c0b1b3529c628ba6b2b81bdbc6d212f666b2f20f/react-v18.2.0/src/react/packages/react-reconciler/src/ReactFiber.old.js#L118" target="_blank" rel="noreferrer">function FiberNode | ReactFiber.old.js</a></p></blockquote><div class="language-ts vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> FiberNode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  tag</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> WorkTag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// /react-reconciler/src/ReactWorkTags.js</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  pendingProps</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> mixed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  key</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  mode</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> TypeOfMode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  /*! --------------- ä½œä¸ºé™æ€æ•°æ®ç»“æ„ --------------- */</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.tag </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> tag </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Fiber å¯¹åº”ç»„ä»¶çš„ç±»å‹</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.key </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> key </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// key</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.elementType </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // å¤§éƒ¨åˆ†æƒ…å†µåŒ typeï¼ŒæŸäº›æƒ…å†µä¸åŒï¼Œæ¯”å¦‚ FunctionComponent ä½¿ç”¨ React.memo åŒ…è£¹</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.type </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // FunctionComponent æŒ‡å‡½æ•°æœ¬èº«ï¼›ClassComponent æŒ‡ classï¼›HostComponent æŒ‡ DOM èŠ‚ç‚¹çš„tagName</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.stateNode </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // Fiber å¯¹åº”çš„çœŸå®DOMèŠ‚ç‚¹</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  /*! --------------- ä½œä¸º Fiber æ¶æ„ --------------- */</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.return </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // æŒ‡å‘çˆ¶çº§ Fiber èŠ‚ç‚¹</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.child </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // æŒ‡å‘ç¬¬ä¸€ä¸ªå­ Fiber èŠ‚ç‚¹</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.sibling </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // æŒ‡å‘ä¸‹ä¸€ä¸ªå…„å¼Ÿ Fiber èŠ‚ç‚¹</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.index </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.ref </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  /*! -------------- ä½œä¸ºåŠ¨æ€çš„å·¥ä½œå•å…ƒ --------------- */</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ä¿å­˜æœ¬æ¬¡æ›´æ–°é€ æˆçš„çŠ¶æ€æ”¹å˜ç›¸å…³ä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.pendingProps </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pendingProps</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.memoizedProps </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.updateQueue </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.memoizedState </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.dependencies </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.mode </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> mode</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Effects å‰¯ä½œç”¨ç›¸å…³</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.flags </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> NoFlags</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.subtreeFlags </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> NoFlags</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.deletions </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // è°ƒåº¦ä¼˜å…ˆçº§ç›¸å…³</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.lanes </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> NoLanes</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.childLanes </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> NoLanes</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // æŒ‡å‘è¯¥ Fiber èŠ‚ç‚¹å¯¹åº”çš„åŒç¼“å­˜ Fiber èŠ‚ç‚¹</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.alternate </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div><h2 id="fiber-åŒç¼“å­˜" tabindex="-1">Fiber åŒç¼“å­˜ <a class="header-anchor" href="#fiber-åŒç¼“å­˜" aria-label="Permalink to &quot;Fiber åŒç¼“å­˜&quot;">â€‹</a></h2><div class="tip custom-block"><p class="custom-block-title">åŒç¼“å­˜</p><p>å½“æˆ‘ä»¬ç”¨ <code>canvas</code> ç»˜åˆ¶åŠ¨ç”»æ—¶ï¼Œæ¯ä¸€å¸§ç»˜åˆ¶å‰éƒ½ä¼šè°ƒç”¨ <code>ctx.clearRect</code> æ¸…é™¤ä¸Šä¸€å¸§çš„ç”»é¢ï¼Œå¦‚æœå½“å‰å¸§ç”»é¢è®¡ç®—é‡æ¯”è¾ƒå¤§ï¼Œå¯¼è‡´æ¸…é™¤ä¸Šä¸€å¸§ç”»é¢åˆ°ç»˜åˆ¶å½“å‰å¸§ç”»é¢ä¹‹é—´æœ‰è¾ƒé•¿é—´éš™ï¼Œå°±ä¼šå‡ºç°ç™½å±ã€‚</p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å†…å­˜ä¸­ç»˜åˆ¶å½“å‰å¸§åŠ¨ç”»ï¼Œç»˜åˆ¶å®Œæ¯•åç›´æ¥ç”¨å½“å‰å¸§æ›¿æ¢ä¸Šä¸€å¸§ç”»é¢ï¼Œç”±äºçœå»äº†ä¸¤å¸§æ›¿æ¢é—´çš„è®¡ç®—æ—¶é—´ï¼Œä¸ä¼šå‡ºç°ä»ç™½å±åˆ°å‡ºç°ç”»é¢çš„é—ªçƒæƒ…å†µã€‚</p><p>è¿™ç§åœ¨<strong>å†…å­˜ä¸­æ„å»ºå¹¶ç›´æ¥æ›¿æ¢</strong>çš„æŠ€æœ¯å«åšåŒç¼“å­˜</p></div><p>React ä½¿ç”¨â€œåŒç¼“å­˜â€æ¥å®Œæˆ Fiber æ ‘çš„æ„å»ºä¸æ›¿æ¢â€”â€”å¯¹åº”ç€ DOM æ ‘çš„åˆ›å»ºä¸æ›´æ–°</p><h3 id="fiber-åŒç¼“å­˜çš„æ„å»º" tabindex="-1">Fiber åŒç¼“å­˜çš„æ„å»º <a class="header-anchor" href="#fiber-åŒç¼“å­˜çš„æ„å»º" aria-label="Permalink to &quot;Fiber åŒç¼“å­˜çš„æ„å»º&quot;">â€‹</a></h3><p>åœ¨ React ä¸­æœ€å¤šä¼šåŒæ—¶å­˜åœ¨ä¸¤æ£µ Fiber æ ‘</p><ul><li>å½“å‰å±å¹•ä¸Šæ˜¾ç¤ºå†…å®¹å¯¹åº”çš„ Fiber æ ‘å«åš <code>current Fiber æ ‘</code></li><li>æ­£åœ¨å†…å­˜ä¸­æ„å»ºçš„ Fiber æ ‘å«åš <code>workInProgress Fiber æ ‘</code></li></ul><p>React åº”ç”¨çš„æ ¹èŠ‚ç‚¹é€šè¿‡ä½¿ <code>current</code> æŒ‡é’ˆåœ¨ä¸åŒ <code>Fiber æ ‘</code> çš„ <code>rootFiber</code> é—´åˆ‡æ¢æ¥å®Œæˆ <code>current Fiber æ ‘</code> æŒ‡å‘çš„åˆ‡æ¢</p><p>å½“ <code>workInProgress Fiber æ ‘</code> æ„å»ºå®Œæˆäº¤ç»™ <code>Renderer</code> æ¸²æŸ“åœ¨é¡µé¢ä¸Šåï¼ŒReact ä¼šå°†åº”ç”¨æ ¹èŠ‚ç‚¹çš„ <code>current</code> æŒ‡é’ˆæŒ‡å‘ <code>workInProgress Fiber æ ‘</code>ï¼Œæ­¤æ—¶ <code>workInProgress Fiber æ ‘</code> å°±å˜ä¸º <code>current Fiber æ ‘</code></p><p>æ¯æ¬¡çŠ¶æ€æ›´æ–°éƒ½ä¼šäº§ç”Ÿæ–°çš„ <code>workInProgress Fiber æ ‘</code>ï¼Œé€šè¿‡ <code>current</code> ä¸ <code>workInProgress</code> çš„æ›¿æ¢ï¼Œå®Œæˆ DOM æ›´æ–°</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><ul><li><code>current Fiber æ ‘</code> ä¸­çš„ <code>Fiber èŠ‚ç‚¹</code> è¢«ç§°ä¸º <code>current fiber</code></li><li><code>workInProgress Fiber æ ‘</code> ä¸­çš„ <code>Fiber èŠ‚ç‚¹</code> è¢«ç§°ä¸º <code>workInProgress fiber</code></li><li><code>current Fiber æ ‘</code> ä¸­çš„ <code>Fiber èŠ‚ç‚¹</code> éƒ½æœ‰ <code>alternate</code> å±æ€§æŒ‡å‘ <code>workInProgress Fiber æ ‘</code> ä¸­å¯¹åº”çš„ <code>Fiber èŠ‚ç‚¹</code></li></ul><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">currentFiber.alternate </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> workInProgressFiber</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">workInProgressFiber.alternate </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> currentFiber</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></div><h3 id="mount-é˜¶æ®µ" tabindex="-1"><code>mount</code> é˜¶æ®µ <a class="header-anchor" href="#mount-é˜¶æ®µ" aria-label="Permalink to &quot;\`mount\` é˜¶æ®µ&quot;">â€‹</a></h3><blockquote><p>ä»¥ä¸‹é¢çš„ä»£ç ä¸º ğŸŒ°</p></blockquote><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> App</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">num</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> useState</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">p</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> onClick</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> add</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(num </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)}&gt;{num}&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">p</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ReactDOM.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">render</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">App</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /&gt;, document.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getElementById</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;root&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ol><li>é¦–æ¬¡æ‰§è¡Œ <code>ReactDOM.render</code> æ—¶ä¼šåˆ›å»º <code>fiberRootNode</code>ï¼ˆæºç ä¸­å« <code>fiberRoot</code>ï¼‰å’Œ <code>rootFiber</code></li></ol><ul><li><code>fiberRootNode</code> æ˜¯æ•´ä¸ªåº”ç”¨çš„æ ¹èŠ‚ç‚¹</li><li><code>rootFiber</code> æ˜¯ <code>&lt;App/&gt;</code> æ‰€åœ¨ç»„ä»¶æ ‘çš„æ ¹èŠ‚ç‚¹</li></ul><div class="tip custom-block"><p class="custom-block-title">ä¸ºä»€ä¹ˆè¦åŒºåˆ† <code>fiberRootNode</code> ä¸ <code>rootFiber</code></p><p>å› ä¸ºåœ¨ä¸€ä¸ª React åº”ç”¨ä¸­æˆ‘ä»¬å¯ä»¥å¤šæ¬¡è°ƒç”¨ <code>ReactDOM.render</code> æ¥æ¸²æŸ“ä¸åŒçš„ç»„ä»¶æ ‘ï¼Œè¿™æ—¶å®ƒä»¬ä¼šæ‹¥æœ‰ä¸åŒçš„ <code>rootFiber</code>ã€‚ä½†æ˜¯æ•´ä¸ªåº”ç”¨çš„æ ¹èŠ‚ç‚¹åªæœ‰ä¸€ä¸ªé‚£å°±æ˜¯ <code>fiberRootNode</code></p></div><p>è¿™æ—¶ <code>fiberRootNode</code> çš„ <code>current</code> æŒ‡é’ˆä¼šæŒ‡å‘å½“å‰é¡µé¢ä¸Šå·²æ¸²æŸ“å†…å®¹å¯¹åº” <code>Fiber æ ‘</code>ï¼ˆå³ <code>current Fiber æ ‘</code>ï¼‰</p><p><img src="`+l+'" alt="rootFiber" loading="lazy"></p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">fiberRootNode.current </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> rootFiber</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>ç”±äºæ˜¯é¦–å±æ¸²æŸ“ï¼Œé¡µé¢ä¸­è¿˜æ²¡æœ‰æŒ‚è½½ä»»ä½• DOMï¼Œæ‰€ä»¥ <code>fiberRootNode.current</code> æŒ‡å‘çš„ <code>rootFiber</code> æ˜¯æ²¡æœ‰ä»»ä½• <code>å­ Fiber èŠ‚ç‚¹</code>çš„ï¼ˆå³<code>current Fiber æ ‘</code>ä¸ºç©ºï¼‰</p><ol start="2"><li>æ¥ä¸‹æ¥è¿›å…¥ <code>render é˜¶æ®µ</code>ï¼Œæ ¹æ®ç»„ä»¶è¿”å›çš„ JSX åœ¨å†…å­˜ä¸­ä¾æ¬¡åˆ›å»º <code>Fiber èŠ‚ç‚¹</code> å¹¶è¿æ¥åœ¨ä¸€èµ·æ„å»º <code>Fiber æ ‘</code>ï¼Œå…¶è¢«ç§°ä¸º<code>workInProgress Fiber æ ‘</code>ï¼ˆä¸‹å›¾ä¸­å³ä¾§ä¸ºå†…å­˜ä¸­æ„å»ºçš„æ ‘ï¼Œå·¦ä¾§ä¸ºé¡µé¢æ˜¾ç¤ºçš„æ ‘ï¼‰</li></ol><p>åœ¨æ„å»º <code>workInProgress Fiber æ ‘</code> æ—¶ä¼šå°è¯•å¤ç”¨ <code>current Fiber æ ‘</code> ä¸­å·²æœ‰çš„ <code>Fiber èŠ‚ç‚¹</code> å†…çš„å±æ€§ï¼Œåœ¨<code>é¦–å±æ¸²æŸ“</code>æ—¶åªæœ‰ <code>rootFiber</code> å­˜åœ¨å¯¹åº”çš„ <code>current fiber</code>ï¼ˆå³ <code>rootFiber.alternate</code>ï¼‰</p><p><img src="'+r+'" alt="workInProgressFiber" loading="lazy"></p><ol start="3"><li>å›¾ä¸­å³ä¾§å·²æ„å»ºå®Œçš„ <code>workInProgress Fiber æ ‘</code> ä¼šåœ¨ <code>commit é˜¶æ®µ</code> æ¸²æŸ“åˆ°é¡µé¢</li></ol><p>æ­¤æ—¶ DOM æ›´æ–°ä¸ºå³ä¾§æ ‘å¯¹åº”çš„ç•Œé¢ã€‚<code>fiberRootNode</code> çš„ <code>current</code> æŒ‡é’ˆæŒ‡å‘ <code>workInProgress Fiber æ ‘</code> ä½¿å…¶å˜æ›´ä¸º<code>current Fiber æ ‘</code>ï¼ˆå³ä¸‹å›¾æ‰€ç¤ºï¼‰</p><p><img src="'+p+'" alt="wipTreeFinish" loading="lazy"></p><h3 id="update-é˜¶æ®µ" tabindex="-1"><code>update</code> é˜¶æ®µ <a class="header-anchor" href="#update-é˜¶æ®µ" aria-label="Permalink to &quot;`update` é˜¶æ®µ&quot;">â€‹</a></h3><ol><li>å½“æˆ‘ä»¬ç‚¹å‡» <code>p èŠ‚ç‚¹</code> è§¦å‘çŠ¶æ€æ”¹å˜æ—¶ï¼Œä¼šå¼€å¯ä¸€æ¬¡æ–°çš„ <code>render é˜¶æ®µ</code> å¹¶æ„å»ºä¸€æ£µæ–°çš„ <code>workInProgress Fiber æ ‘</code></li></ol><p><img src="'+t+'" alt="wipTreeUpdate" loading="lazy"></p><p>å’Œ <code>mount</code> æ—¶ä¸€æ ·ï¼Œ<code>workInProgress fiber</code> çš„åˆ›å»ºä¼šå¤ç”¨ <code>current Fiber æ ‘</code> ä¸­å¯¹åº”çš„èŠ‚ç‚¹æ•°æ®</p><blockquote><p>å†³å®šæ˜¯å¦å¤ç”¨çš„è¿‡ç¨‹å°±æ˜¯ Diff ç®—æ³•</p></blockquote><ol start="2"><li><code>workInProgress Fiber æ ‘</code> åœ¨ <code>render é˜¶æ®µ</code> å®Œæˆæ„å»ºåè¿›å…¥ <code>commit é˜¶æ®µ</code> æ¸²æŸ“åˆ°é¡µé¢ä¸Šã€‚åœ¨æ¸²æŸ“å®Œæ¯•å<code>workInProgress Fiber æ ‘</code> å˜æ›´ä¸º <code>current Fiber æ ‘</code></li></ol><p><img src="'+h+'" alt="currentTreeUpdate" loading="lazy"></p><hr><div class="info custom-block"><p class="custom-block-title">ç›¸å…³èµ„æ–™</p><ul><li><a href="https://react.iamkasong.com/process/fiber.html" target="_blank" rel="noreferrer">Fiber æ¶æ„çš„å®ç°åŸç† | React æŠ€æœ¯æ­ç§˜</a></li><li><a href="https://react.iamkasong.com/process/doubleBuffer.html" target="_blank" rel="noreferrer">Fiber æ¶æ„çš„å·¥ä½œåŸç† | React æŠ€æœ¯æ­ç§˜</a></li></ul></div>',45)]))}const u=i(k,[["render",d]]);export{y as __pageData,u as default};
