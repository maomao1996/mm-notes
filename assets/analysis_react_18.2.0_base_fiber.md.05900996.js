import{_ as s,v as n,b as a,R as e}from"./chunks/framework.975b469a.js";const l="/mm-notes/assets/rootfiber.3263dda8.png",o="/mm-notes/assets/workInProgressFiber.e476948b.png",p="/mm-notes/assets/wipTreeFinish.01903533.png",r="/mm-notes/assets/wipTreeUpdate.b570d550.png",c="/mm-notes/assets/currentTreeUpdate.dce275cd.png",h=JSON.parse('{"title":"Fiber æ¶æ„å’ŒåŒç¼“å­˜","description":"","frontmatter":{},"headers":[],"relativePath":"analysis/react/18.2.0/base/fiber.md","filePath":"analysis/react/18.2.0/base/fiber.md","lastUpdated":1693026860000}'),t={name:"analysis/react/18.2.0/base/fiber.md"},i=e(`<h1 id="fiber-æ¶æ„å’ŒåŒç¼“å­˜" tabindex="-1">Fiber æ¶æ„å’ŒåŒç¼“å­˜ <a class="header-anchor" href="#fiber-æ¶æ„å’ŒåŒç¼“å­˜" aria-label="Permalink to &quot;Fiber æ¶æ„å’ŒåŒç¼“å­˜&quot;">â€‹</a></h1><p>React 16 å¼€å§‹å¼•å…¥äº† Fiber æ¶æ„ï¼Œå®ƒçš„ä¸»è¦ç›®çš„æ˜¯ä¸ºäº†è§£å†³ React 15 å­˜åœ¨çš„ä¸€äº›é—®é¢˜ï¼Œæ¯”å¦‚é€’å½’è°ƒç”¨æ ˆè¿‡æ·±å¯¼è‡´çš„å¡é¡¿ã€æ— æ³•ä¸­æ–­æ¸²æŸ“ã€æ— æ³•ä¼˜å…ˆçº§æ›´æ–°ç­‰ã€‚å³<strong>å°†é€’å½’çš„æ— æ³•ä¸­æ–­çš„æ›´æ–°é‡æ„ä¸ºå¼‚æ­¥çš„å¯ä¸­æ–­æ›´æ–°</strong></p><h2 id="fiber-çš„å«ä¹‰" tabindex="-1">Fiber çš„å«ä¹‰ <a class="header-anchor" href="#fiber-çš„å«ä¹‰" aria-label="Permalink to &quot;Fiber çš„å«ä¹‰&quot;">â€‹</a></h2><p>Fiber çš„ä¸‰å±‚å«ä¹‰ï¼š</p><ul><li><strong>ä½œä¸ºæ¶æ„</strong>æ¥è¯´ï¼š <ul><li>React 15 çš„ <code>Reconciler</code> é‡‡ç”¨é€’å½’çš„æ–¹å¼æ‰§è¡Œï¼Œæ•°æ®ä¿å­˜åœ¨é€’å½’è°ƒç”¨æ ˆä¸­ï¼Œæ‰€ä»¥è¢«ç§°ä¸º <code>stack Reconciler</code></li><li>React 16 çš„ <code>Reconciler</code> åŸºäº <code>Fiber èŠ‚ç‚¹</code> å®ç°ï¼Œè¢«ç§°ä¸º <code>Fiber Reconciler</code></li></ul></li><li><strong>ä½œä¸ºé™æ€çš„æ•°æ®ç»“æ„</strong>æ¥è¯´ï¼šæ¯ä¸ª <code>Fiber èŠ‚ç‚¹</code> å¯¹åº”ä¸€ä¸ª <code>React element</code> ï¼Œä¿å­˜äº†è¯¥ç»„ä»¶çš„ç±»å‹ï¼ˆå‡½æ•°ç»„ä»¶/ç±»ç»„ä»¶/åŸç”Ÿç»„ä»¶...ï¼‰ã€å¯¹åº”çš„ DOM èŠ‚ç‚¹ç­‰ä¿¡æ¯</li><li><strong>ä½œä¸ºåŠ¨æ€çš„å·¥ä½œå•å…ƒ</strong>æ¥è¯´ï¼šæ¯ä¸ª <code>Fiber èŠ‚ç‚¹</code> ä¿å­˜äº†æœ¬æ¬¡æ›´æ–°ä¸­è¯¥ç»„ä»¶æ”¹å˜çš„çŠ¶æ€ã€è¦æ‰§è¡Œçš„å·¥ä½œï¼ˆéœ€è¦è¢«åˆ é™¤/è¢«æ’å…¥é¡µé¢ä¸­/è¢«æ›´æ–°...ï¼‰</li></ul><div class="tip custom-block"><p class="custom-block-title">Fiber Reconciler çš„ä¸»è¦ä½œç”¨</p><ul><li>èƒ½å¤ŸæŠŠå¯ä¸­æ–­çš„ä»»åŠ¡åˆ‡ç‰‡å¤„ç†</li><li>èƒ½å¤Ÿè°ƒæ•´ä¼˜å…ˆçº§ï¼Œé‡ç½®å¹¶å¤ç”¨ä»»åŠ¡</li><li>èƒ½å¤Ÿåœ¨çˆ¶å…ƒç´ ä¸å­å…ƒç´ ä¹‹é—´äº¤é”™å¤„ç†ï¼Œä»¥æ”¯æŒ React ä¸­çš„å¸ƒå±€</li><li>èƒ½å¤Ÿåœ¨ <code>render()</code> ä¸­è¿”å›å¤šä¸ªå…ƒç´ </li><li>æ›´å¥½åœ°æ”¯æŒé”™è¯¯è¾¹ç•Œ</li></ul><p><a href="https://zh-hans.legacy.reactjs.org/docs/codebase-overview.html#fiber-reconciler" target="_blank" rel="noreferrer">Fiber reconciler | React æ—§ç‰ˆå®˜æ–¹æ–‡æ¡£</a></p></div><h2 id="fiber-çš„æ•°æ®ç»“æ„" tabindex="-1">Fiber çš„æ•°æ®ç»“æ„ <a class="header-anchor" href="#fiber-çš„æ•°æ®ç»“æ„" aria-label="Permalink to &quot;Fiber çš„æ•°æ®ç»“æ„&quot;">â€‹</a></h2><p>Fiber ä¸Šä¸»è¦æœ‰ DOMã€Fiber æ ‘ã€çŠ¶æ€æ•°æ®ã€å‰¯ä½œç”¨å››ç§æ ‡è¯†</p><blockquote><p>æºç åœ°å€ <a href="https://github.com/maomao1996/code-analysis/blob/9a3aa89acc830353e3795276b0eda4e96e840975/react-v18.2.0/src/react/packages/react-reconciler/src/ReactFiber.old.js#L118" target="_blank" rel="noreferrer">function FiberNode | ReactFiber.old.js</a></p></blockquote><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">FiberNode</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#A6ACCD;font-style:italic;">tag</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">WorkTag</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// /react-reconciler/src/ReactWorkTags.js</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#A6ACCD;font-style:italic;">pendingProps</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">mixed</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#A6ACCD;font-style:italic;">key</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">null</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#A6ACCD;font-style:italic;">mode</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">TypeOfMode</span></span>
<span class="line"><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#676E95;font-style:italic;">/*! --------------- ä½œä¸ºé™æ€æ•°æ®ç»“æ„ --------------- */</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">tag</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">tag</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// Fiber å¯¹åº”ç»„ä»¶çš„ç±»å‹</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">key</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">key</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// key</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">elementType</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">null</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// å¤§éƒ¨åˆ†æƒ…å†µåŒ typeï¼ŒæŸäº›æƒ…å†µä¸åŒï¼Œæ¯”å¦‚ FunctionComponent ä½¿ç”¨ React.memo åŒ…è£¹</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">type</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">null</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// FunctionComponent æŒ‡å‡½æ•°æœ¬èº«ï¼›ClassComponent æŒ‡ classï¼›HostComponent æŒ‡ DOM èŠ‚ç‚¹çš„tagName</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">stateNode</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">null</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// Fiber å¯¹åº”çš„çœŸå®DOMèŠ‚ç‚¹</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#676E95;font-style:italic;">/*! --------------- ä½œä¸º Fiber æ¶æ„ --------------- */</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">null</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// æŒ‡å‘çˆ¶çº§ Fiber èŠ‚ç‚¹</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">child</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">null</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// æŒ‡å‘ç¬¬ä¸€ä¸ªå­ Fiber èŠ‚ç‚¹</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">sibling</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">null</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// æŒ‡å‘ä¸‹ä¸€ä¸ªå…„å¼Ÿ Fiber èŠ‚ç‚¹</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">index</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">ref</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">null</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#676E95;font-style:italic;">/*! -------------- ä½œä¸ºåŠ¨æ€çš„å·¥ä½œå•å…ƒ --------------- */</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// ä¿å­˜æœ¬æ¬¡æ›´æ–°é€ æˆçš„çŠ¶æ€æ”¹å˜ç›¸å…³ä¿¡æ¯</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">pendingProps</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">pendingProps</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">memoizedProps</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">null</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">updateQueue</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">null</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">memoizedState</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">null</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">dependencies</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">null</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">mode</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">mode</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// Effects å‰¯ä½œç”¨ç›¸å…³</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">flags</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">NoFlags</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">subtreeFlags</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">NoFlags</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">deletions</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">null</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// è°ƒåº¦ä¼˜å…ˆçº§ç›¸å…³</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">lanes</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">NoLanes</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">childLanes</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">NoLanes</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// æŒ‡å‘è¯¥ Fiber èŠ‚ç‚¹å¯¹åº”çš„åŒç¼“å­˜ Fiber èŠ‚ç‚¹</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">alternate</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">null</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div><h2 id="fiber-åŒç¼“å­˜" tabindex="-1">Fiber åŒç¼“å­˜ <a class="header-anchor" href="#fiber-åŒç¼“å­˜" aria-label="Permalink to &quot;Fiber åŒç¼“å­˜&quot;">â€‹</a></h2><div class="tip custom-block"><p class="custom-block-title">åŒç¼“å­˜</p><p>å½“æˆ‘ä»¬ç”¨ <code>canvas</code> ç»˜åˆ¶åŠ¨ç”»æ—¶ï¼Œæ¯ä¸€å¸§ç»˜åˆ¶å‰éƒ½ä¼šè°ƒç”¨ <code>ctx.clearRect</code> æ¸…é™¤ä¸Šä¸€å¸§çš„ç”»é¢ï¼Œå¦‚æœå½“å‰å¸§ç”»é¢è®¡ç®—é‡æ¯”è¾ƒå¤§ï¼Œå¯¼è‡´æ¸…é™¤ä¸Šä¸€å¸§ç”»é¢åˆ°ç»˜åˆ¶å½“å‰å¸§ç”»é¢ä¹‹é—´æœ‰è¾ƒé•¿é—´éš™ï¼Œå°±ä¼šå‡ºç°ç™½å±ã€‚</p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å†…å­˜ä¸­ç»˜åˆ¶å½“å‰å¸§åŠ¨ç”»ï¼Œç»˜åˆ¶å®Œæ¯•åç›´æ¥ç”¨å½“å‰å¸§æ›¿æ¢ä¸Šä¸€å¸§ç”»é¢ï¼Œç”±äºçœå»äº†ä¸¤å¸§æ›¿æ¢é—´çš„è®¡ç®—æ—¶é—´ï¼Œä¸ä¼šå‡ºç°ä»ç™½å±åˆ°å‡ºç°ç”»é¢çš„é—ªçƒæƒ…å†µã€‚</p><p>è¿™ç§åœ¨<strong>å†…å­˜ä¸­æ„å»ºå¹¶ç›´æ¥æ›¿æ¢</strong>çš„æŠ€æœ¯å«åšåŒç¼“å­˜</p></div><p>React ä½¿ç”¨â€œåŒç¼“å­˜â€æ¥å®Œæˆ Fiber æ ‘çš„æ„å»ºä¸æ›¿æ¢â€”â€”å¯¹åº”ç€ DOM æ ‘çš„åˆ›å»ºä¸æ›´æ–°</p><h3 id="fiber-åŒç¼“å­˜çš„æ„å»º" tabindex="-1">Fiber åŒç¼“å­˜çš„æ„å»º <a class="header-anchor" href="#fiber-åŒç¼“å­˜çš„æ„å»º" aria-label="Permalink to &quot;Fiber åŒç¼“å­˜çš„æ„å»º&quot;">â€‹</a></h3><p>åœ¨ React ä¸­æœ€å¤šä¼šåŒæ—¶å­˜åœ¨ä¸¤æ£µ Fiber æ ‘</p><ul><li>å½“å‰å±å¹•ä¸Šæ˜¾ç¤ºå†…å®¹å¯¹åº”çš„ Fiber æ ‘å«åš <code>current Fiber æ ‘</code></li><li>æ­£åœ¨å†…å­˜ä¸­æ„å»ºçš„ Fiber æ ‘å«åš <code>workInProgress Fiber æ ‘</code></li></ul><p>React åº”ç”¨çš„æ ¹èŠ‚ç‚¹é€šè¿‡ä½¿ <code>current</code> æŒ‡é’ˆåœ¨ä¸åŒ <code>Fiber æ ‘</code> çš„ <code>rootFiber</code> é—´åˆ‡æ¢æ¥å®Œæˆ <code>current Fiber æ ‘</code> æŒ‡å‘çš„åˆ‡æ¢</p><p>å½“ <code>workInProgress Fiber æ ‘</code> æ„å»ºå®Œæˆäº¤ç»™ <code>Renderer</code> æ¸²æŸ“åœ¨é¡µé¢ä¸Šåï¼ŒReact ä¼šå°†åº”ç”¨æ ¹èŠ‚ç‚¹çš„ <code>current</code> æŒ‡é’ˆæŒ‡å‘ <code>workInProgress Fiber æ ‘</code>ï¼Œæ­¤æ—¶ <code>workInProgress Fiber æ ‘</code> å°±å˜ä¸º <code>current Fiber æ ‘</code></p><p>æ¯æ¬¡çŠ¶æ€æ›´æ–°éƒ½ä¼šäº§ç”Ÿæ–°çš„ <code>workInProgress Fiber æ ‘</code>ï¼Œé€šè¿‡ <code>current</code> ä¸ <code>workInProgress</code> çš„æ›¿æ¢ï¼Œå®Œæˆ DOM æ›´æ–°</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><ul><li><code>current Fiber æ ‘</code> ä¸­çš„ <code>Fiber èŠ‚ç‚¹</code> è¢«ç§°ä¸º <code>current fiber</code></li><li><code>workInProgress Fiber æ ‘</code> ä¸­çš„ <code>Fiber èŠ‚ç‚¹</code> è¢«ç§°ä¸º <code>workInProgress fiber</code></li><li><code>current Fiber æ ‘</code> ä¸­çš„ <code>Fiber èŠ‚ç‚¹</code> éƒ½æœ‰ <code>alternate</code> å±æ€§æŒ‡å‘ <code>workInProgress Fiber æ ‘</code> ä¸­å¯¹åº”çš„ <code>Fiber èŠ‚ç‚¹</code></li></ul><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">currentFiber</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">alternate </span><span style="color:#89DDFF;">===</span><span style="color:#A6ACCD;"> workInProgressFiber</span></span>
<span class="line"><span style="color:#A6ACCD;">workInProgressFiber</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">alternate </span><span style="color:#89DDFF;">===</span><span style="color:#A6ACCD;"> currentFiber</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></div><h3 id="mount-é˜¶æ®µ" tabindex="-1"><code>mount</code> é˜¶æ®µ <a class="header-anchor" href="#mount-é˜¶æ®µ" aria-label="Permalink to &quot;\`mount\` é˜¶æ®µ&quot;">â€‹</a></h3><blockquote><p>ä»¥ä¸‹é¢çš„ä»£ç ä¸º ğŸŒ°</p></blockquote><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">App</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">num</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">add</span><span style="color:#89DDFF;">]</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">useState</span><span style="color:#F07178;">(</span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">p</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">onClick</span><span style="color:#89DDFF;">={()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">add</span><span style="color:#A6ACCD;">(num </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">}&gt;{</span><span style="color:#A6ACCD;">num</span><span style="color:#89DDFF;">}&lt;/</span><span style="color:#F07178;">p</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">ReactDOM</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">render</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">App</span><span style="color:#89DDFF;"> /&gt;,</span><span style="color:#A6ACCD;"> document</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getElementById</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">root</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">))</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ol><li>é¦–æ¬¡æ‰§è¡Œ <code>ReactDOM.render</code> æ—¶ä¼šåˆ›å»º <code>fiberRootNode</code>ï¼ˆæºç ä¸­å« <code>fiberRoot</code>ï¼‰å’Œ <code>rootFiber</code></li></ol><ul><li><code>fiberRootNode</code> æ˜¯æ•´ä¸ªåº”ç”¨çš„æ ¹èŠ‚ç‚¹</li><li><code>rootFiber</code> æ˜¯ <code>&lt;App/&gt;</code> æ‰€åœ¨ç»„ä»¶æ ‘çš„æ ¹èŠ‚ç‚¹</li></ul><div class="tip custom-block"><p class="custom-block-title">ä¸ºä»€ä¹ˆè¦åŒºåˆ† <code>fiberRootNode</code> ä¸ <code>rootFiber</code></p><p>å› ä¸ºåœ¨ä¸€ä¸ª React åº”ç”¨ä¸­æˆ‘ä»¬å¯ä»¥å¤šæ¬¡è°ƒç”¨ <code>ReactDOM.render</code> æ¥æ¸²æŸ“ä¸åŒçš„ç»„ä»¶æ ‘ï¼Œè¿™æ—¶å®ƒä»¬ä¼šæ‹¥æœ‰ä¸åŒçš„ <code>rootFiber</code>ã€‚ä½†æ˜¯æ•´ä¸ªåº”ç”¨çš„æ ¹èŠ‚ç‚¹åªæœ‰ä¸€ä¸ªé‚£å°±æ˜¯ <code>fiberRootNode</code></p></div><p>è¿™æ—¶ <code>fiberRootNode</code> çš„ <code>current</code> æŒ‡é’ˆä¼šæŒ‡å‘å½“å‰é¡µé¢ä¸Šå·²æ¸²æŸ“å†…å®¹å¯¹åº” <code>Fiber æ ‘</code>ï¼ˆå³ <code>current Fiber æ ‘</code>ï¼‰</p><p><img src="`+l+'" alt="rootFiber"></p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">fiberRootNode</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">current </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> rootFiber</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>ç”±äºæ˜¯é¦–å±æ¸²æŸ“ï¼Œé¡µé¢ä¸­è¿˜æ²¡æœ‰æŒ‚è½½ä»»ä½• DOMï¼Œæ‰€ä»¥ <code>fiberRootNode.current</code> æŒ‡å‘çš„ <code>rootFiber</code> æ˜¯æ²¡æœ‰ä»»ä½• <code>å­ Fiber èŠ‚ç‚¹</code>çš„ï¼ˆå³<code>current Fiber æ ‘</code>ä¸ºç©ºï¼‰</p><ol start="2"><li>æ¥ä¸‹æ¥è¿›å…¥ <code>render é˜¶æ®µ</code>ï¼Œæ ¹æ®ç»„ä»¶è¿”å›çš„ JSX åœ¨å†…å­˜ä¸­ä¾æ¬¡åˆ›å»º <code>Fiber èŠ‚ç‚¹</code> å¹¶è¿æ¥åœ¨ä¸€èµ·æ„å»º <code>Fiber æ ‘</code>ï¼Œå…¶è¢«ç§°ä¸º<code>workInProgress Fiber æ ‘</code>ï¼ˆä¸‹å›¾ä¸­å³ä¾§ä¸ºå†…å­˜ä¸­æ„å»ºçš„æ ‘ï¼Œå·¦ä¾§ä¸ºé¡µé¢æ˜¾ç¤ºçš„æ ‘ï¼‰</li></ol><p>åœ¨æ„å»º <code>workInProgress Fiber æ ‘</code> æ—¶ä¼šå°è¯•å¤ç”¨ <code>current Fiber æ ‘</code> ä¸­å·²æœ‰çš„ <code>Fiber èŠ‚ç‚¹</code> å†…çš„å±æ€§ï¼Œåœ¨<code>é¦–å±æ¸²æŸ“</code>æ—¶åªæœ‰ <code>rootFiber</code> å­˜åœ¨å¯¹åº”çš„ <code>current fiber</code>ï¼ˆå³ <code>rootFiber.alternate</code>ï¼‰</p><p><img src="'+o+'" alt="workInProgressFiber"></p><ol start="3"><li>å›¾ä¸­å³ä¾§å·²æ„å»ºå®Œçš„ <code>workInProgress Fiber æ ‘</code> ä¼šåœ¨ <code>commit é˜¶æ®µ</code> æ¸²æŸ“åˆ°é¡µé¢</li></ol><p>æ­¤æ—¶ DOM æ›´æ–°ä¸ºå³ä¾§æ ‘å¯¹åº”çš„ç•Œé¢ã€‚<code>fiberRootNode</code> çš„ <code>current</code> æŒ‡é’ˆæŒ‡å‘ <code>workInProgress Fiber æ ‘</code> ä½¿å…¶å˜æ›´ä¸º<code>current Fiber æ ‘</code>ï¼ˆå³ä¸‹å›¾æ‰€ç¤ºï¼‰</p><p><img src="'+p+'" alt="wipTreeFinish"></p><h2 id="update-é˜¶æ®µ" tabindex="-1"><code>update</code> é˜¶æ®µ <a class="header-anchor" href="#update-é˜¶æ®µ" aria-label="Permalink to &quot;`update` é˜¶æ®µ&quot;">â€‹</a></h2><ol><li>å½“æˆ‘ä»¬ç‚¹å‡» <code>p èŠ‚ç‚¹</code> è§¦å‘çŠ¶æ€æ”¹å˜æ—¶ï¼Œä¼šå¼€å¯ä¸€æ¬¡æ–°çš„ <code>render é˜¶æ®µ</code> å¹¶æ„å»ºä¸€æ£µæ–°çš„ <code>workInProgress Fiber æ ‘</code></li></ol><p><img src="'+r+'" alt="wipTreeUpdate"></p><p>å’Œ <code>mount</code> æ—¶ä¸€æ ·ï¼Œ<code>workInProgress fiber</code> çš„åˆ›å»ºä¼šå¤ç”¨ <code>current Fiber æ ‘</code> ä¸­å¯¹åº”çš„èŠ‚ç‚¹æ•°æ®</p><blockquote><p>å†³å®šæ˜¯å¦å¤ç”¨çš„è¿‡ç¨‹å°±æ˜¯ Diff ç®—æ³•</p></blockquote><ol start="2"><li><code>workInProgress Fiber æ ‘</code> åœ¨ <code>render é˜¶æ®µ</code> å®Œæˆæ„å»ºåè¿›å…¥ <code>commit é˜¶æ®µ</code> æ¸²æŸ“åˆ°é¡µé¢ä¸Šã€‚åœ¨æ¸²æŸ“å®Œæ¯•å<code>workInProgress Fiber æ ‘</code> å˜æ›´ä¸º <code>current Fiber æ ‘</code></li></ol><p><img src="'+c+'" alt="currentTreeUpdate"></p><hr><div class="tip custom-block"><p class="custom-block-title">ç›¸å…³èµ„æ–™</p><ul><li><a href="https://react.iamkasong.com/process/fiber.html" target="_blank" rel="noreferrer">Fiber æ¶æ„çš„å®ç°åŸç† | React æŠ€æœ¯æ­ç§˜</a></li><li><a href="https://react.iamkasong.com/process/doubleBuffer.html" target="_blank" rel="noreferrer">Fiber æ¶æ„çš„å·¥ä½œåŸç† | React æŠ€æœ¯æ­ç§˜</a></li></ul></div>',45),F=[i];function y(d,b,D,u,C,A){return n(),a("div",null,F)}const g=s(t,[["render",y]]);export{h as __pageData,g as default};
