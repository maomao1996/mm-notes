# ES6 å¸¸ç”¨çŸ¥è¯†

`ECMAScript 6` (ç®€ç§° `ES6`) æ˜¯ `JavaScript` è¯­è¨€çš„ä¸‹ä¸€ä»£æ ‡å‡†

`ECMAScript` çš„ææ¡ˆæµç¨‹

- `Stage 0 - Strawman`ï¼ˆå±•ç¤ºé˜¶æ®µï¼‰
- `Stage 1 - Proposal`ï¼ˆå¾æ±‚æ„è§é˜¶æ®µï¼‰
- `Stage 2 - Draft`ï¼ˆè‰æ¡ˆé˜¶æ®µï¼‰
- `Stage 3 - Candidate`ï¼ˆå€™é€‰äººé˜¶æ®µï¼‰
- `Stage 4 - Finished`ï¼ˆå®šæ¡ˆé˜¶æ®µï¼‰

ä¸€ä¸ªææ¡ˆåªè¦èƒ½è¿›å…¥ `Stage 2` å°±å·®ä¸å¤šè‚¯å®šä¼šåŒ…æ‹¬åœ¨ä»¥åçš„æ­£å¼æ ‡å‡†é‡Œé¢

[ECMAScript å½“å‰çš„æ‰€æœ‰ææ¡ˆ](https://github.com/tc39/ecma262)

::: tip ES6 å’Œ ES2015 çš„åŒºåˆ«
`ES2015` æ˜¯ä¸€ä¸ªå¹´ä»½æ ‡è®°ï¼Œè¡¨ç¤ºå½“å¹´å‘å¸ƒçš„ `ECMAScript` æ ‡å‡†çš„æ­£å¼ç‰ˆæœ¬ï¼Œå…¶å…¨ç§°ä¸ºã€Š`ECMAScript 2015` æ ‡å‡†ã€‹ï¼ˆç®€ç§° `ES2015`ï¼‰<br>
`ES6` æ˜¯ä¸€ä¸ªå†å²åè¯ä¹Ÿæ˜¯ä¸€ä¸ªæ³›æŒ‡ï¼Œå«ä¹‰æ˜¯ `5.1` ç‰ˆä»¥åçš„ `JavaScript` çš„ä¸‹ä¸€ä»£æ ‡å‡†ï¼Œæ¶µç›–äº† `ES2015ã€ES2016ã€ES2017 ES2018` ç­‰ç­‰
:::

## let const

`ES6` æ–°å¢äº† **`let`** å’Œ **`const`** å‘½ä»¤ï¼Œç”¨äºå£°æ˜å˜é‡ï¼Œå…¶å£°æ˜çš„å˜é‡åªåœ¨å£°æ˜æ‰€åœ¨çš„å—çº§ä½œç”¨åŸŸå†…æœ‰æ•ˆ

::: tip let const var çš„åŒºåˆ«

- `var` å£°æ˜çš„å˜é‡ä¼šæå‡åˆ°ä½œç”¨åŸŸçš„é¡¶éƒ¨ï¼Œ`let const` ä¸å­˜åœ¨å˜é‡æå‡
- `var` å£°æ˜çš„å…¨å±€å˜é‡ä¼šè¢«æŒ‚è½½åˆ°å…¨å±€å¯¹è±¡ `window` ä¸Šï¼Œè€Œ `let const` ä¸ä¼š
- `var` å¯ä»¥å¯¹ä¸€ä¸ªå˜é‡è¿›è¡Œé‡å¤å£°æ˜ï¼Œè€Œ `let const` ä¸èƒ½é‡å¤å£°æ˜
- `var` å£°æ˜çš„å˜é‡ä½œç”¨åŸŸèŒƒå›´æ˜¯å‡½æ•°ä½œç”¨åŸŸï¼Œ`let const` å£°æ˜çš„å˜é‡ä½œç”¨åŸŸèŒƒå›´æ˜¯å—çº§ä½œç”¨åŸŸ
- `const` å£°æ˜çš„æ˜¯ä¸€ä¸ªåªè¯»çš„å¸¸é‡ï¼Œä¸€æ—¦å£°æ˜å¸¸é‡çš„å€¼å°±ä¸èƒ½æ”¹å˜(å¿…é¡»å¯¹å˜é‡è¿›è¡Œåˆå§‹åŒ–)
  - åŸºæœ¬ç±»å‹ä¿è¯å€¼ä¸å¯å˜
  - å¼•ç”¨ç±»å‹ä¿è¯å†…å­˜æŒ‡é’ˆä¸å¯å˜

:::

### å˜é‡æå‡

```js
console.log(a) // è¾“å‡º undefined
console.log(b) // æŠ¥é”™
console.log(c) // æŠ¥é”™

var a = 'var'
let b = 'let'
const c = 'const'
```

### æŒ‚è½½åˆ°å…¨å±€å¯¹è±¡

```js
var a = 'var'
let b = 'let'
const c = 'const'

console.log(window.a) // è¾“å‡º var
console.log(window.b) // è¾“å‡º undefined
console.log(window.c) // è¾“å‡º undefined
```

### é‡å¤å£°æ˜

```js
var a = 'var'
var a
console.log(a) // è¾“å‡º var

let b = 'let'
let b // æŠ¥é”™
```

### ä½œç”¨åŸŸèŒƒå›´

```js
function fn() {
  if (true) {
    var a = 'var'
    let b = 'let'

    console.log(a) // è¾“å‡º var
    console.log(b) // è¾“å‡º let
  }

  console.log(a) // è¾“å‡º var
  console.log(b) // æŠ¥é”™
}

fn()
```

### const å¸¸é‡å®šä¹‰

```js
const NAME = 'maomao'
NAME = 'maomao1996' // æŠ¥é”™
```

## æ¨¡æ¿å­—ç¬¦ä¸²

æ¨¡æ¿å­—ç¬¦ä¸² (template string) æ˜¯å¢å¼ºç‰ˆçš„å­—ç¬¦ä¸²ï¼Œç”¨åå¼•å·(**`**)æ ‡è¯†ã€‚å®ƒå¯ä»¥å½“ä½œæ™®é€šå­—ç¬¦ä¸²ã€å®šä¹‰å¤šè¡Œå­—ç¬¦ä¸²æˆ–è€…åœ¨å­—ç¬¦ä¸²ä¸­åµŒå…¥å˜é‡ã€å‡½æ•°è°ƒç”¨ä»¥åŠè¡¨è¾¾å¼

```js
let name = 'maomao'
let age = 18

/* ES5 æ‹¼æ¥å­—ç¬¦ä¸² */
let es5Str = 'æˆ‘å«: ' + name + 'ï¼Œæˆ‘çš„å¹´é¾„æ˜¯: ' + (age + 1) + ' å²'

/* ES6 æ¨¡æ¿å­—ç¬¦ä¸² */
let es6Str = `æˆ‘å«: ${name}ï¼Œæˆ‘çš„å¹´é¾„æ˜¯: ${age + 1} å²`
```

## è§£æ„èµ‹å€¼

### è§£æ„å¯¹è±¡

```js
const obj = {
  name: 'maomao',
  age: 18
}

// ES5 å†™æ³•
const name = obj.name
const age = obj.age

/* ES6 è§£æ„å†™æ³• */
const { name, age } = obj
// é‡å‘½å
const { name: myName } = obj
```

### è§£æ„æ•°ç»„

```js
const arr = ['maomao', 18]

/* ES5 å†™æ³• */
const name = arr[0]
const age = arr[1]

/* ES6 è§£æ„å†™æ³• */
const [name, age] = arr
const { 0: name, 1: age } = arr
```

## å‡½æ•°çš„æ‰©å±•

### å‚æ•°é»˜è®¤å€¼

```js
/* ES5 */
function add(x, y) {
  // å½“å‚æ•° y å¯¹åº”çš„å¸ƒå°”å€¼ä¸º false åˆ™è¯¥èµ‹å€¼ä¸èµ·ä½œç”¨
  y = y || 1
  console.log(x + y)
}
add(10) // 11
add(10, 2) // 12
add(10, 0) // 11

/* ES6 */
function add(x, y = 1) {
  console.log(x + y)
}
add(10) // 11
add(10, 2) // 12
add(10, 0) // 10
```

::: tip å‡½æ•°å‚æ•°çš„é»˜è®¤å€¼

- å‚æ•°å˜é‡æ˜¯é»˜è®¤å£°æ˜çš„ä¸èƒ½ç”¨ `let`æˆ– `const` å†æ¬¡å£°æ˜ï¼Œå¦åˆ™ä¼šæŠ¥é”™
- ä½¿ç”¨å‚æ•°é»˜è®¤å€¼æ—¶å‡½æ•°ä¸èƒ½æœ‰åŒåå‚æ•°
- å‚æ•°é»˜è®¤å€¼çš„ä½ç½®åº”è¯¥æ˜¯å‡½æ•°çš„å°¾å‚æ•°

:::

### å‰©ä½™å‚æ•°(rest å‚æ•°)

`ES6` å¼•å…¥ `rest` å‚æ•°(å½¢å¼ä¸º `...å˜é‡å`) ç”¨äºè·å–å‡½æ•°çš„å‰©ä½™å‚æ•°(å¯ä»¥æ›¿æ¢ `arguments` å¯¹è±¡)

```js
function log(name, ...params) {
  console.log(name, params)
}

log('maomao', 1, 2) // maomaoÂ [1, 2]
log('maomao', 1, 2, 3) // maomaoÂ [1, 2, 3]
```

::: tip å‰©ä½™å‚æ•°(rest å‚æ•°)

- `rest` å‚æ•°æ˜¯ä¸€ä¸ªçœŸæ­£çš„æ•°ç»„ï¼Œæ•°ç»„ç‰¹æœ‰çš„æ–¹æ³•éƒ½å¯ä»¥ä½¿ç”¨
- `rest` å‚æ•°ä¹‹åä¸èƒ½å†æœ‰å…¶ä»–å‚æ•°ï¼Œå¦åˆ™ä¼šæŠ¥é”™
- å‡½æ•°çš„ `length` å±æ€§ï¼Œä¸åŒ…æ‹¬ `rest` å‚æ•°

:::

### ç®­å¤´å‡½æ•°

`ES6` å…è®¸ä½¿ç”¨**ç®­å¤´**(`=>`)å®šä¹‰å‡½æ•°

```js
// ä¸éœ€è¦å‚æ•°æ—¶ä½¿ç”¨ä¸€ä¸ªåœ†æ‹¬å·ä»£è¡¨å‚æ•°éƒ¨åˆ†
const fn = () => {}
// ç­‰åŒäº
const fn = function () {}

// å½“å‡½æ•°ä½“åªæœ‰ return æ—¶
const fn = (value) => value
// ç­‰åŒäº
const fn = function (value) {
  return value
}
const fn = () => {
  console.log('this', this)
}
```

::: tip ç®­å¤´å‡½æ•°ä¸æ™®é€šå‡½æ•°çš„åŒºåˆ«

- `this`
  - æ™®é€šå‡½æ•°
    - `this` æŒ‡å‘æ˜¯åŠ¨æ€çš„(å–å†³äºå‡½æ•°çš„è°ƒç”¨æ–¹å¼)
    - å¯ä»¥ç”¨ `call apply bind` æ”¹å˜ `this` æŒ‡å‘
  - ç®­å¤´å‡½æ•°
    - `this` æŒ‡å‘æ˜¯å›ºå®šçš„ï¼ŒæŒ‡å‘å®šä¹‰æ—¶ä¸Šå±‚ä½œç”¨åŸŸä¸­çš„ `this`(å®ƒæ²¡æœ‰è‡ªå·±çš„ `this`)
    - `call apply bind` æ— æ³•æ”¹å˜ç®­å¤´å‡½æ•°çš„ `this` æŒ‡å‘(ä¸Šä¸‹æ–‡å€¼å§‹ç»ˆæŒ‰è¯æ³•è§£æ)
    - å…¨å±€ä½œç”¨åŸŸä¸‹ `this` æŒ‡å‘å…¨å±€å¯¹è±¡
- ç®­å¤´å‡½æ•°ä¸å¯ä»¥å½“ä½œæ„é€ å‡½æ•°(ä¸èƒ½ä½¿ç”¨ `new` è¿ç®—ç¬¦ï¼Œå¦åˆ™ä¼šæŠ¥é”™)
- ç®­å¤´å‡½æ•°çš„å‡½æ•°ä½“å†…ä¸å¯ä»¥ä½¿ç”¨`arguments super new.target`
- ç®­å¤´å‡½æ•°ä¸å¯ä»¥ä½¿ç”¨ yield å‘½ä»¤(ä¸èƒ½ç”¨ä½œ `Generator` å‡½æ•°)
- åœ¨ `class` ä¸­ä½¿ç”¨ç®­å¤´å‡½æ•°å…¶ `this` ä¼šå’Œç±»å®ä¾‹è¿›è¡Œç»‘å®š

:::

[åˆ©ç”¨ `babel` ç¼–è¯‘ç®­å¤´å‡½æ•°ä»£ç æŸ¥çœ‹ `this` çš„æŒ‡å‘](https://www.babeljs.cn/repl#?browsers=defaults%2C%20not%20ie%2011%2C%20not%20ie_mob%2011&build=&builtIns=false&corejs=3.6&spec=false&loose=false&code_lz=MYewdgzgLgBANiA5jAvDAFASlQPhgbwCgYZRIQ4BTAOgUXQHI6YoALASwgC4GAaFjhEyEAvoUIAzAK5hgUduBgSwWAsRgRKUACrsAtpRBSo6VSjxESJMhAo06jZQM49-bTsJIj-ARgAMfsIiQA&debug=false&forceAllTransforms=true&shippedProposals=false&circleciRepo=&evaluate=false&fileSize=false&timeTravel=false&sourceType=script&lineWrap=true&presets=env%2Creact&prettier=false&targets=&version=7.17.11&externalPlugins=&assumptions=%7B%7D)

```js
/* ES6 */
const log = () => {
  console.log('log this:', this)
}

function fn() {
  setTimeout(() => {
    console.log('fn this:', this)
  }, 100)
}

/* babel ç¼–è¯‘åçš„ ES5 ä»£ç  */
var _this = this

var log = function log() {
  console.log('log this:', _this)
}

function fn() {
  var _this2 = this

  setTimeout(function () {
    console.log('fn this:', _this2)
  }, 100)
}
```

## æ‰©å±•è¿ç®—ç¬¦

æ‰©å±•è¿ç®—ç¬¦ (`spread`)æ˜¯ä¸‰ä¸ªç‚¹ (`...`) å®ƒå¥½æ¯” `rest` å‚æ•°çš„é€†è¿ç®—

### å‡½æ•°è°ƒç”¨

æ‰©å±•è¿ç®—ç¬¦åœ¨å‡½æ•°è°ƒç”¨æ—¶å¯ä»¥å°†ä¸€ä¸ªæ•°ç»„å˜ä¸ºå‚æ•°åºåˆ—ï¼Œä»è€Œå¯ä»¥æ›¿ä»£å‡½æ•°çš„ `apply()` æ–¹æ³•

```js
// ä¸¾ä¸ª ğŸŒ° æ±‚å‡ºä¸€ä¸ªæ•°ç»„æœ€å¤§å…ƒç´ 
/* ES5 å†™æ³• */
Math.max.apply(null, [2022, 520, 1314])

/* ES6 å†™æ³• */
Math.max(...[2022, 520, 1314])
// ç­‰åŒäº
Math.max(2022, 520, 1314)
```

### æ‹·è´æ•°ç»„/å¯¹è±¡

```js
/* æ‹·è´æ•°ç»„ */
const arr1 = [1, 2, 3]
// å†™æ³•ä¸€
const arr2 = [...arr1]
// å†™æ³•äºŒ
const [...arr2] = arr1

/* æ‹·è´å¯¹è±¡ */
const obj1 = { name: 'maomao' }
// å†™æ³•ä¸€
const obj2 = { ...obj1 }
// å†™æ³•äºŒ
const { ...obj2 } = obj1
```

### åˆå¹¶æ•°ç»„/å¯¹è±¡

```js
/* åˆå¹¶æ•°ç»„ */
const arr1 = [1, 2, 3]
const arr2 = ['a', 'b', 'c']
const arr = [...arr1, ...arr2]

/* åˆå¹¶å¯¹è±¡ */
const obj1 = { name: 'maomao' }
const obj2 = { age: 18 }
const obj = { ...obj1, ...obj2 }
```

### ä½¿ç”¨è¡¨è¾¾å¼

```js
const obj = {
  ...(false ? { a: 1 } : {}),
  b: 2
}
// {b: 2}

const obj = {
  ...(true ? { a: 1 } : {}),
  b: 2
}
// {a: 1, b: 2}
```

### ä¸è§£æ„èµ‹å€¼ç»“åˆ

```js
const arr1 = [1, 2, 3]

/* ES5 å†™æ³• */
const first = arr1[0]
const rest = arr1.slice(1)

/* ES6 å†™æ³• */
const [first, ...rest] = arr1
```

::: tip æ‰©å±•è¿ç®—ç¬¦

- ä½¿ç”¨æ‰©å±•è¿ç®—ç¬¦æ‹·è´æ•°ç»„æˆ–å¯¹è±¡æ—¶å…¶éƒ½æ˜¯**æµ…æ‹·è´**
- å¯¹è±¡çš„æ‰©å±•è¿ç®—ç¬¦ç­‰åŒäºä½¿ç”¨ `Object.assign()` æ–¹æ³•
- åªæœ‰å‡½æ•°è°ƒç”¨æ—¶æ‰©å±•è¿ç®—ç¬¦æ‰å¯ä»¥æ”¾åœ¨åœ†æ‹¬å·ä¸­ï¼Œå¦åˆ™ä¼šæŠ¥é”™
- æ‰©å±•è¿ç®—ç¬¦ç”¨äºèµ‹å€¼æ—¶åªèƒ½æ”¾åœ¨å‚æ•°çš„æœ€åä¸€ä½ï¼Œå¦åˆ™ä¼šæŠ¥é”™

:::

## æ•°ç»„çš„æ‰©å±•

### Array.from()

`Array.from()` ç”¨äºå°†ä¸¤ç±»å¯¹è±¡è½¬ä¸ºçœŸæ­£çš„æ•°ç»„

- ç±»ä¼¼æ•°ç»„çš„å¯¹è±¡ (`array-like object`)
  - `DOM` æ“ä½œè¿”å›çš„ `NodeList`
  - `arguments` å¯¹è±¡
- å¯éå† (`iterable`) çš„å¯¹è±¡ (åŒ…æ‹¬ `ES6` æ–°å¢çš„æ•°æ®ç»“æ„ `Set` å’Œ `Map`)

```js
/* array-like object è½¬æ•°ç»„ */
const arrayLike = {
  0: 'a',
  1: 'b',
  2: 'c',
  length: 3
}

// ES5 å†™æ³•
var arr1 = [].slice.call(arrayLike) // ['a', 'b', 'c']

// ES6 å†™æ³•
let arr2 = Array.from(arrayLike) // ['a', 'b', 'c']
```

::: tip Array.from()

`Array.from()` å¯ä»¥æ¥å—ä¸€ä¸ªå‡½æ•°ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ï¼Œä½œç”¨ç±»ä¼¼äºæ•°ç»„çš„`map()` ç”¨æ¥å¯¹æ¯ä¸ªå…ƒç´ è¿›è¡Œå¤„ç†ï¼Œå°†å¤„ç†åçš„å€¼æ”¾å…¥è¿”å›çš„æ•°ç»„

åœ¨å­—ç¬¦ä¸²è½¬ä¸ºæ•°ç»„æ—¶ `Array.from()` èƒ½æ­£ç¡®å¤„ç†å„ç§ `Unicode` å­—ç¬¦ï¼Œå¯ä»¥é¿å… `JavaScript` å°†å¤§äº `\uFFFF` çš„ `Unicode` å­—ç¬¦ç®—ä½œä¸¤ä¸ªå­—ç¬¦çš„ `bug`

```js
'ğ ®·'.length // 2
Array.from('ğ ®·').length // 1

'ğŸ‘ª'.length // 2
Array.from('ğŸ‘ª').length // 1
```

:::

### Array.of()

`Array.of()` ç”¨äºå°†ä¸€ç»„å€¼è½¬æ¢ä¸ºæ•°ç»„

```js
Array.of(3, 11, 8) // [3,11,8]
Array.of(3) // [3]
Array.of(3).length // 1
```

::: tip Array.of()

`Array.of()` æ–¹æ³•çš„ä¸»è¦ç›®çš„æ˜¯å¼¥è¡¥æ•°ç»„æ„é€ å‡½æ•° `Array()` çš„ä¸è¶³(å› ä¸ºå‚æ•°ä¸ªæ•°çš„ä¸åŒä¼šå¯¼è‡´`Array()`çš„è¡Œä¸ºæœ‰å·®å¼‚)

```js
Array() // []
Array(3) // [, , ,]
Array(3, 11, 8) // [3, 11, 8]
```

`Array.of()` æ€»æ˜¯è¿”å›å‚æ•°å€¼ç»„æˆçš„æ•°ç»„ã€‚å¦‚æœæ²¡æœ‰å‚æ•°å°±è¿”å›ä¸€ä¸ªç©ºæ•°ç»„

```js
/* Array.of() çš„æ¨¡æ‹Ÿå®ç° */
function ArrayOf() {
  return [].slice.call(arguments)
}
```

:::

### å®ä¾‹æ–¹æ³•: includes()

`includes()` æ–¹æ³•è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæŸä¸ªæ•°ç»„æ˜¯å¦åŒ…å«ç»™å®šçš„å€¼(`ES2016` å¼•å…¥)

```js
const arr = [1, 2, NaN]
arr.includes(2) // true
arr.includes(4) // false
arr.includes(NaN) // true
```

::: tip includes() å’Œ indexOf() çš„å¯¹æ¯”

`indexOf()` ä¸å¤Ÿè¯­ä¹‰åŒ–ï¼Œå…¶å«ä¹‰æ˜¯æ‰¾åˆ°å‚æ•°å€¼çš„ç¬¬ä¸€ä¸ªå‡ºç°ä½ç½®ï¼Œæ‰€ä»¥è¦å»æ¯”è¾ƒæ˜¯å¦ä¸ç­‰äº `-1`ï¼Œè¡¨è¾¾èµ·æ¥ä¸å¤Ÿç›´è§‚<br>
`indexOf()` å†…éƒ¨ä½¿ç”¨ä¸¥æ ¼ç›¸ç­‰è¿ç®—ç¬¦ (`===`) è¿›è¡Œåˆ¤æ–­ï¼Œè¿™ä¼šå¯¼è‡´å¯¹ `NaN` çš„è¯¯åˆ¤

:::

### å®ä¾‹æ–¹æ³•: find() å’Œ findIndex()

`find()` æ–¹æ³•ç”¨äºæ‰¾å‡ºç¬¬ä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„æ•°ç»„æˆå‘˜ï¼Œå¦‚æœ**æ²¡æœ‰ç¬¦åˆæ¡ä»¶çš„æˆå‘˜åˆ™è¿”å› `undefined`**

`findIndex()` æ–¹æ³•ç”¨äºæ‰¾å‡ºç¬¬ä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„æ•°ç»„æˆå‘˜çš„ä½ç½®ï¼Œå¦‚æœ**æ²¡æœ‰ç¬¦åˆæ¡ä»¶çš„æˆå‘˜åˆ™è¿”å› `-1`**

```js
const arr = [1, 5, 10, 15]

/* find() */
arr.find((item) => item > 9) // 10
arr.find((item) => item === 9) // undefined

/* findIndex() */
arr.findIndex((item) => item > 9) // 2
arr.findIndex((item) => item === 9) // -1
```

### å®ä¾‹æ–¹æ³•: at()

`at()` æ–¹æ³•æ¥å—ä¸€ä¸ªæ•´æ•°(æ”¯æŒè´Ÿæ•°)ä½œä¸ºå‚æ•°è¿”å›å¯¹åº”ä½ç½®çš„æˆå‘˜ï¼Œå¦‚æœ**å‚æ•°ä½ç½®è¶…å‡ºäº†æ•°ç»„èŒƒå›´åˆ™è¿”å› `undefined`**

```js
const arr = ['maomao', 18]

arr.at(0) // 'maomao'
arr.at(-1) // 18
arr.at(99) // undefined
```

### å®ä¾‹æ–¹æ³•: flat() å’Œ flatMap()

`flat()` æ–¹æ³•ç”¨äºå°†åµŒå¥—çš„æ•°ç»„æ‹å¹³å˜æˆä¸€ç»´çš„æ•°ç»„ï¼Œè¯¥æ–¹æ³•**è¿”å›ä¸€ä¸ªæ–°æ•°ç»„ä¸æ”¹å˜åŸæ•°ç»„**

`flatMap()` æ–¹æ³•ä¼šå…ˆå¯¹åŸæ•°ç»„çš„æ¯ä¸ªæˆå‘˜æ‰§è¡Œä¸€ä¸ªå‡½æ•°(ç›¸å½“äºæ‰§è¡Œ `Array.prototype.map()`) ç„¶åå¯¹è¿”å›å€¼ç»„æˆçš„æ•°ç»„æ‰§è¡Œ `flat()` æ–¹æ³•ï¼Œè¯¥æ–¹æ³•**è¿”å›ä¸€ä¸ªæ–°æ•°ç»„ä¸æ”¹å˜åŸæ•°ç»„**

```js
/* flat() */
const arr1 = [1, 2, [3, [4, 5]]]
const arr2 = [1, 2, , 4, 5]

arr1.flat() // [1, 2, 3, [4, 5]]
arr1.flat(2) // [1, 2, 3, 4, 5]

arr2.flat() // [1, 2, 4, 5]

/* flatMap() */
const arr = [1, 2, 3, 4]
arr.flatMap((x) => [[x * 2]]) // [[2], [4], [6], [8]]
// ç›¸å½“äº [[2, 4], [3, 6], [4, 8]].flat()
```

::: tip flat() å’Œ flatMap() æ³¨æ„ç‚¹

- `flat()` æ–¹æ³•é»˜è®¤åªä¼šæ‹‰å¹³ä¸€å±‚
- `flat()`æ–¹æ³•ä¼šè·³è¿‡åŸæ•°ç»„ä¸­çš„ç©ºä½
- `flatMap()` åªèƒ½å±•å¼€ä¸€å±‚æ•°ç»„

:::

## å¯¹è±¡çš„æ‰©å±•

### å±æ€§ç®€å†™

`ES6` å…è®¸åœ¨å¤§æ‹¬å·é‡Œé¢ç›´æ¥å†™å…¥å˜é‡å’Œå‡½æ•°ä½œä¸ºå¯¹è±¡çš„å±æ€§å’Œæ–¹æ³•

```js
/* å±æ€§ç®€å†™ */
// ES5 å†™æ³•
const key = 'maomao'
const obj = { key: key }

// ES6 å†™æ³•
const key = 'maomao'
const obj = { key }

/* æ–¹æ³•ç®€å†™ */
// ES5 å†™æ³•
const obj = {
  log: function () {
    console.log('maomao')
  }
}

// ES6 å†™æ³•
const key = 'maomao'
const obj = {
  log() {}
}
```

::: tip å±æ€§ç®€å†™

ç®€å†™çš„å¯¹è±¡æ–¹æ³•ä¸èƒ½ç”¨ä½œæ„é€ å‡½æ•°å¦åˆ™ä¼šæŠ¥é”™

```js
const obj = {
  f() {
    this.name = 'maomao'
  }
}

new obj.f() // æŠ¥é”™
```

:::

### å±æ€§åè¡¨è¾¾å¼

```js
// å®šä¹‰å±æ€§å
const key = 'age'
const obj = {
  ['name' + 1]: 'maomao',
  [key]: 18
}

// å®šä¹‰æ–¹æ³•å
const obj = {
  ['log' + 'name']() {
    console.log('maomao')
  }
}
```

::: tip å±æ€§åè¡¨è¾¾å¼

å±æ€§åè¡¨è¾¾å¼ä¸å±æ€§ç®€å†™ä¸èƒ½åŒæ—¶ä½¿ç”¨å¦åˆ™ä¼šæŠ¥é”™

```js
// æŠ¥é”™
const key = 'name';
const obj = { [key] }

// æ­£ç¡®
const key = 'name';
const obj = { [key]: 'maomao'};
```

å±æ€§åè¡¨è¾¾å¼å¦‚æœæ˜¯ä¸€ä¸ªå¯¹è±¡ä¼šè‡ªåŠ¨å°†å…¶è½¬ä¸ºå­—ç¬¦ä¸² `[object Object]`

```js
const keyA = { a: 1 }
const keyB = { b: 2 }

const obj = {
  [keyA]: 'valueA',
  [keyB]: 'valueB'
}

console.log(obj) // {[object Object]: 'valueB'}
```

:::

### Object.is()

`Object.is()` æ–¹æ³•ç”¨æ¥æ¯”è¾ƒä¸¤ä¸ªå€¼æ˜¯å¦ä¸¥æ ¼ç›¸ç­‰ï¼Œä¸¥æ ¼æ¯”è¾ƒè¿ç®—ç¬¦ (`===`) çš„è¡Œä¸ºåŸºæœ¬ä¸€è‡´

```js
Object.is('key', 'key') // true
Object.is({}, {}) // false
```

::: tip Object.is() ä¸ === çš„ä¸åŒä¹‹å¤„

`+0`ä¸ç­‰äº`-0`

```js
/* +0 ä¸ç­‰äº -0 */
;+0 === -0 // true
Object.is(+0, -0) // false

/* NaN ç­‰äºè‡ªèº« */
NaN === NaN // false
Object.is(NaN, NaN) // true
```

:::

### Object.assign()

`Object.assign()` æ–¹æ³•ç”¨äºå¯¹è±¡çš„åˆå¹¶ï¼Œå°†æºå¯¹è±¡çš„æ‰€æœ‰å¯æšä¸¾å±æ€§å¤åˆ¶åˆ°ç›®æ ‡å¯¹è±¡ï¼ˆç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç›®æ ‡å¯¹è±¡åé¢çš„å‚æ•°éƒ½æ˜¯æºå¯¹è±¡ï¼‰

```js
const target = { a: 1, b: 1 }

const source1 = { b: 2, c: 2 }
const source2 = { c: 3 }

Object.assign(target, source1, source2)
```

##### åªæœ‰ä¸€ä¸ªå‚æ•°æ—¶ä¼šç›´æ¥è¿”å›è¯¥å‚æ•°

```js
const obj = { a: 1 }
Object.assign(obj) === obj // true
```

##### ä¼ å…¥å‚æ•°ä¸æ˜¯å¯¹è±¡æ—¶ä¼šå…ˆè½¬æˆå¯¹è±¡å†è¿”å›

```js
typeof Object.assign(1) // "object"
typeof Object.assign(true) // "object"
```

##### ä¼ å…¥éå¯¹è±¡ç±»å‹çš„åœºæ™¯

```js
/* undefined å’Œ null */
// é¦–ä½å‚æ•°æ—¶ä¼šæŠ¥é”™
Object.assign(undefined) // TypeError
Object.assign(null) // TypeError
// éé¦–ä½å‚æ•°æ—¶ä¼šå¿½ç•¥
const obj = {}
Object.assign(obj, undefined) === obj // true
Object.assign(obj, null) === obj // true

/* éé¦–ä½å‚æ•°ä¸ºæ•°å€¼ å¸ƒå°”å€¼ å­—ç¬¦ä¸²æ—¶ */
// æ•°å€¼å’Œå¸ƒå°”å€¼ä¼šå¿½ç•¥
const obj = {}
Object.assign(obj, 1, true) === obj // true
// å­—ç¬¦ä¸²ä¼šä»¥å­—ç¬¦æ•°ç»„çš„å½¢å¼åšåˆå¹¶
Object.assign({}, 'maomao') // {0: 'm', 1: 'a', 2: 'o', 3: 'm', 4: 'a', 5: 'o'}

/* æ•°ç»„ */
// å½“å‚æ•°éƒ½ä¸ºæ•°ç»„æ—¶
Object.assign([1, 2, 3], [4, 5]) // [4, 5, 3]
// å½“é¦–ä½å‚æ•°ä¸ºå¯¹è±¡æ—¶ï¼Œåç»­å‚æ•°ä¸ºæ•°ç»„æ—¶
Object.assign({ a: 1 }, [1, 2]) // {0: 1, 1: 2, a: 1}
```

##### ä¼ å…¥æ•°ç»„æ—¶ä¼šæŠŠæ•°ç»„å½“å¯¹è±¡å¤„ç†

```js
Object.assign([1, 2, 3], [4, 5]) // [4, 5, 3]
```

::: tip Object.assign() æ€»ç»“å’Œåº”ç”¨åœºæ™¯

æ€»ç»“

- `Object.assign()` æ˜¯**æµ…æ‹·è´**æ–¹æ³•
- å­˜åœ¨åŒåå±æ€§æ—¶ï¼Œåé¢çš„å±æ€§ä¼šè¦†ç›–å‰é¢çš„å±æ€§
- åªæœ‰ä¸€ä¸ªå‚æ•°æ—¶ä¼šç›´æ¥è¿”å›è¯¥å‚æ•°
- ä¼ å…¥å‚æ•°ä¸æ˜¯å¯¹è±¡æ—¶ä¼šå…ˆè½¬æˆå¯¹è±¡å†è¿”å›
- ä¼ å…¥ `undefined` å’Œ `null` æ—¶
  - å¦‚æœä¸ºç¬¬ä¸€ä¸ªå‚æ•°ä¼šæŠ¥é”™ï¼ˆæ— æ³•è½¬æˆå¯¹è±¡ï¼‰
  - å¦‚æœä¸ä¸ºç¬¬ä¸€ä¸ªå‚æ•°æ—¶ä¼šè¢«å¿½ç•¥
- ä¼ å…¥æ•°ç»„æ—¶ä¼šæŠŠæ•°ç»„å½“å¯¹è±¡å¤„ç†

åº”ç”¨åœºæ™¯

```js
/* ä¸ºå¯¹è±¡æ·»åŠ å±æ€§ */
class Point {
  constructor(x, y) {
    Object.assign(this, { x, y })
  }
}

/* ä¸ºå¯¹è±¡æ·»åŠ æ–¹æ³• */
Object.assign(Function.prototype, {
  log() {}
})

/* æ‹·è´å¯¹è±¡ */
const clone = (origin) => Object.assign({}, origin)

/* åˆå¹¶å¤šä¸ªå¯¹è±¡ */
const merge = (target, ...sources) => Object.assign(target, ...sources)

/* ä¸ºå±æ€§æŒ‡å®šé»˜è®¤å€¼ */
const DEFAULTS = { duration: 2000 }
function toast(options) {
  options = Object.assign({}, DEFAULTS, options)
}
toast({ content: 'æç¤º' }) // {duration: 2000, content: 'æç¤º'}
```

:::

### Object.keys() Object.value() Object.entries()

`Object.keys()` æ–¹æ³•è¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œå…¶æˆå‘˜ä¸ºå‚æ•°å¯¹è±¡è‡ªèº«çš„ï¼ˆä¸å«ç»§æ‰¿çš„ï¼‰æ‰€æœ‰å¯éå†å±æ€§çš„é”®å(`ES5` å¼•å…¥)

`Object.value()` æ–¹æ³•è¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œå…¶æˆå‘˜ä¸ºå‚æ•°å¯¹è±¡è‡ªèº«çš„ï¼ˆä¸å«ç»§æ‰¿çš„ï¼‰æ‰€æœ‰å¯éå†å±æ€§çš„é”®å€¼(`ES2017` å¼•å…¥)

`Object.entries()` æ–¹æ³•è¿”å›ä¸€ä¸ªæ•°ç»„ï¼ˆäºŒç»´æ•°ç»„ï¼‰ï¼Œå…¶æˆå‘˜ä¸ºå‚æ•°å¯¹è±¡è‡ªèº«çš„ï¼ˆä¸å«ç»§æ‰¿çš„ï¼‰æ‰€æœ‰å¯éå†å±æ€§çš„é”®å€¼å¯¹æ•°ç»„(`ES2017` å¼•å…¥)

```js
const obj = { name: 'maomao', age: 18 }
Object.keys(obj) // ['name', 'age']
Object.values(obj) // Â ['maomao', 18]
Object.entries(obj) // [['name', 'maomao'], ['age', 18]]
```

### Object.fromEntries()

`Object.fromEntries()` æ–¹æ³•æ˜¯ `Object.entries()` çš„é€†æ“ä½œï¼Œç”¨äºå°†é”®å€¼å¯¹çš„æ•°æ®ç»“æ„è¿˜åŸä¸ºå¯¹è±¡

```js
Object.fromEntries([['name', 'maomao']]) // {name: 'maomao'}

/* Map è½¬å¯¹è±¡ */
const map = new Map([['name', 'maomao']])
Object.fromEntries(map) // {name: 'maomao'}

/* å°†æŸ¥è¯¢å­—ç¬¦ä¸²è½¬ä¸ºå¯¹è±¡ */
const params = 'name=maomao&age=18'
Object.fromEntries(new URLSearchParams(params)) // {name: 'maomao', age: '18'}
```

### å¯¹è±¡éå†æ–¹æ³•å¯¹æ¯”

| æ–¹æ³•å                       | è¯´æ˜                                                 | ç»§æ‰¿çš„åŸå‹å±æ€§ | ä¸å¯æšä¸¾å±æ€§ | Symbol å±æ€§ |      è¿”å›å€¼      |
| ---------------------------- | :--------------------------------------------------- | :------------: | :----------: | :---------: | :--------------: |
| for...in                     | éå†å¯¹è±¡è‡ªèº«å’Œç»§æ‰¿çš„æ‰€æœ‰å¯æšä¸¾å±æ€§(ä¸å« Symbol å±æ€§) |       âœ…       |      âŒ      |     âŒ      |       key        |
| Object.keys                  | éå†å¯¹è±¡è‡ªèº«æ‰€æœ‰å¯æšä¸¾å±æ€§(ä¸å« Symbol å±æ€§)         |       âŒ       |      âŒ      |     âŒ      |     [key...]     |
| Object.getOwnPropertyNames   | éå†å¯¹è±¡è‡ªèº«æ‰€æœ‰å±æ€§(ä¸å« Symbol å±æ€§)               |       âŒ       |      âœ…      |     âŒ      |     [key...]     |
| Object.getOwnPropertySymbols | éå†å¯¹è±¡è‡ªèº«æ‰€æœ‰çš„ Symbol å±æ€§                       |       âŒ       |      âœ…      |     âœ…      |     [key...]     |
| Reflect.ownKeys              | éå†å¯¹è±¡è‡ªèº«æ‰€æœ‰çš„å±æ€§(åŒ…å«ä¸å¯æšä¸¾å’Œ Symbol å±æ€§)   |       âŒ       |      âœ…      |     âœ…      |     [key...]     |
| Object.values                | éå†å¯¹è±¡è‡ªèº«æ‰€æœ‰å¯æšä¸¾å±æ€§(ä¸å« Symbol å±æ€§)         |       âŒ       |      âŒ      |     âŒ      |    [value...]    |
| Object.entries               | éå†å¯¹è±¡è‡ªèº«æ‰€æœ‰å¯æšä¸¾å±æ€§(ä¸å« Symbol å±æ€§)         |       âŒ       |      âŒ      |     âŒ      | [[key,value]...] |

::: tip éå†é¡ºåº

`ES5` æ²¡æœ‰è§„å®šéå†é¡ºåºï¼Œå…¶éå†é¡ºåºç”±æµè§ˆå™¨å‚å•†å®šä¹‰(å¯ä»¥ç®€å•ç†è§£ä¸ºæ— åºçš„)

`ES6` ä¹‹åè§„å®šéå†é¡ºåºå°†æŒ‰å¦‚ä¸‹è§„åˆ™è¿›è¡Œ

1. é¦–å…ˆéå†æ‰€æœ‰æ•°å€¼é”®ï¼ŒæŒ‰ç…§æ•°å€¼å‡åºæ’åˆ—ã€‚
2. å…¶æ¬¡éå†æ‰€æœ‰å­—ç¬¦ä¸²é”®ï¼ŒæŒ‰ç…§åŠ å…¥æ—¶é—´å‡åºæ’åˆ—ã€‚
3. æœ€åéå†æ‰€æœ‰ `Symbol` é”®ï¼ŒæŒ‰ç…§åŠ å…¥æ—¶é—´å‡åºæ’åˆ—ã€‚

`ES6` å†…éƒ¨å®šä¹‰äº† [\[\[OwnPropertyKeys\]\]()](https://262.ecma-international.org/11.0/#sec-ordinary-object-internal-methods-and-internal-slots-ownpropertykeys) æ–¹æ³•å¯¹å±æ€§è¿›è¡Œåˆ†ç±»å’Œæ’åº

:::

## è¿ç®—ç¬¦çš„æ‰©å±•

### ?. å¯é€‰é“¾æ“ä½œç¬¦

[ES2020](https://github.com/tc39/proposal-optional-chaining) å¼•å…¥äº†å¯é€‰é“¾æ“ä½œç¬¦(åˆåé“¾åˆ¤æ–­è¿ç®—ç¬¦)ï¼Œå…¶å…è®¸æˆ‘ä»¬åœ¨è¯»å–å¯¹è±¡å†…éƒ¨çš„æŸä¸ªå±æ€§æ—¶ï¼Œä¸éœ€è¦åˆ¤æ–­å±æ€§çš„ä¸Šå±‚å¯¹è±¡æ˜¯å¦å­˜åœ¨

```js
// å¯é€‰é“¾æ“ä½œç¬¦ä¹‹å‰çš„å†™æ³•
const firstName =
  (message &&
    message.body &&
    message.body.user &&
    message.body.user.firstName) ||
  'default'

// å¯é€‰é“¾æ“ä½œç¬¦ç®€åŒ–å†™æ³•
const firstName = message?.body?.user?.firstName || 'default'
```

å¯é€‰é“¾æ“ä½œç¬¦ `?.` çš„ä¸‰ç§å†™æ³•

```js
/* å±æ€§æ˜¯å¦å­˜åœ¨ */
obj?.prop
obj?.[expr]
// ç­‰åŒäº
obj == null ? undefined : obj.prop

/* å‡½æ•°æˆ–å¯¹è±¡æ–¹æ³•æ˜¯å¦å­˜åœ¨ */
func?.(...args)
// ç­‰åŒäº
func == null ? undefined : func()
```

::: tip æ³¨æ„ç‚¹

1. å¯é€‰é“¾æ“ä½œç¬¦ç›¸å½“äºä¸€ç§çŸ­è·¯æœºåˆ¶ï¼Œåªè¦ä¸æ»¡è¶³æ¡ä»¶å°±ä¸å†å¾€ä¸‹æ‰§è¡Œ
2. å½“æœ‰æ‹¬å·æ—¶ï¼Œå¯é€‰é“¾æ“ä½œç¬¦å¯¹åœ†æ‹¬å·å¤–éƒ¨æ²¡æœ‰å½±å“ï¼Œåªå¯¹åœ†æ‹¬å·å†…éƒ¨æœ‰å½±å“ã€‚
3. å³ä¾§ä¸å¾—ä¸ºåè¿›åˆ¶æ•°å€¼ã€‚ä¸ºäº†ä¿è¯å…¼å®¹ä»¥å‰çš„ä»£ç ï¼Œå…è®¸ `foo?.3:0` ä¼šè¢«è§£ææˆ `foo ? .3 : 0`ï¼Œå› æ­¤è§„å®šå¦‚æœ `?.` åé¢ç´§è·Ÿä¸€ä¸ªåè¿›åˆ¶æ•°å­—ï¼Œé‚£ä¹ˆ `?.` ä¸å†è¢«çœ‹æˆæ˜¯ä¸€ä¸ªå®Œæ•´çš„è¿ç®—ç¬¦ï¼Œè€Œä¼šæŒ‰ç…§ä¸‰å…ƒè¿ç®—ç¬¦è¿›è¡Œå¤„ç†ï¼Œå³å°æ•°ç‚¹ä¼šå½’å±äºåé¢çš„åè¿›åˆ¶æ•°å­—å½¢æˆä¸€ä¸ªå°æ•°ã€‚
4. ç¦æ­¢ä½¿ç”¨ä»¥ä¸‹å†™æ³•

```js
// æ„é€ å‡½æ•°
new a?.()
new a?.b()

// å³ä¾§æœ‰æ¨¡æ¿å­—ç¬¦ä¸²
a?.`{b}`
a?.b`{c}`

// å·¦ä¾§æ˜¯ super
super?.()
super?.foo

// ç”¨äºèµ‹å€¼è¿ç®—ç¬¦å·¦ä¾§
a?.b = c
```

:::

### ?? ç©ºå€¼åˆå¹¶è¿ç®—ç¬¦

[ES2020](https://github.com/tc39/proposal-nullish-coalescing)å¼•å…¥äº†ç©ºå€¼åˆå¹¶è¿ç®—ç¬¦ï¼Œåªæœ‰è¿ç®—ç¬¦å·¦ä¾§çš„å€¼ä¸º `null` æˆ– `undefined` æ—¶æ‰ä¼šè¿”å›å³ä¾§çš„å€¼

@[code](./code/nullish-coalescing.js)

::: tip ?? å’Œ || çš„åŒºåˆ«

- **`??` è¿ç®—ç¬¦**åªæœ‰å·¦ä¾§æ˜¯ `null` æˆ– `undefined`æ‰ä¼šè¿”å›å³ä¾§çš„å€¼
- **`||` è¿ç®—ç¬¦**åªè¦å·¦ä¾§æ˜¯ [å‡å€¼](/interview/base/conversions.html#toboolean) å°±ä¼šè¿”å›å³ä¾§çš„å€¼

:::

### é€»è¾‘èµ‹å€¼è¿ç®—ç¬¦

`ES2021` å¼•äº†å…¥ä¸‰ä¸ªæ–°çš„é€»è¾‘èµ‹å€¼è¿ç®—ç¬¦ï¼Œç”¨äºå°†é€»è¾‘è¿ç®—ç¬¦ä¸èµ‹å€¼è¿ç®—ç¬¦è¿›è¡Œç»“åˆ

```js
/* æˆ–èµ‹å€¼è¿ç®—ç¬¦ */
x ||= y
// ç­‰åŒäº
x || (x = y)

/* ä¸èµ‹å€¼è¿ç®—ç¬¦ */
x &&= y
// ç­‰åŒäº
x && (x = y)

/* Null èµ‹å€¼è¿ç®—ç¬¦ */
x ??= y
// ç­‰åŒäº
x ?? (x = y)
```
